<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>VuePress</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.a40cd8b1.css" as="style"><link rel="preload" href="/assets/js/app.7430119d.js" as="script"><link rel="preload" href="/assets/js/8.877d9e53.js" as="script"><link rel="prefetch" href="/assets/js/10.d8034afe.js"><link rel="prefetch" href="/assets/js/11.a2cca3ad.js"><link rel="prefetch" href="/assets/js/12.1fa98ea7.js"><link rel="prefetch" href="/assets/js/13.22429314.js"><link rel="prefetch" href="/assets/js/14.f096367b.js"><link rel="prefetch" href="/assets/js/15.95ad47b3.js"><link rel="prefetch" href="/assets/js/16.e778a0b9.js"><link rel="prefetch" href="/assets/js/17.e3c15bfd.js"><link rel="prefetch" href="/assets/js/18.9977483e.js"><link rel="prefetch" href="/assets/js/19.8604e374.js"><link rel="prefetch" href="/assets/js/2.f7e69724.js"><link rel="prefetch" href="/assets/js/20.f1fa3272.js"><link rel="prefetch" href="/assets/js/21.d3056dee.js"><link rel="prefetch" href="/assets/js/22.040b834e.js"><link rel="prefetch" href="/assets/js/23.a905e31b.js"><link rel="prefetch" href="/assets/js/24.3e5caef2.js"><link rel="prefetch" href="/assets/js/25.8d05231f.js"><link rel="prefetch" href="/assets/js/26.db0be9c9.js"><link rel="prefetch" href="/assets/js/27.1f6fecf6.js"><link rel="prefetch" href="/assets/js/28.7c86920f.js"><link rel="prefetch" href="/assets/js/29.cfb7a405.js"><link rel="prefetch" href="/assets/js/3.d002f32a.js"><link rel="prefetch" href="/assets/js/30.114c5ff3.js"><link rel="prefetch" href="/assets/js/31.0020bbf2.js"><link rel="prefetch" href="/assets/js/32.3abc28f0.js"><link rel="prefetch" href="/assets/js/33.d931ff1f.js"><link rel="prefetch" href="/assets/js/34.54e3b98e.js"><link rel="prefetch" href="/assets/js/35.e711c3d3.js"><link rel="prefetch" href="/assets/js/36.147c7917.js"><link rel="prefetch" href="/assets/js/4.582fb8a3.js"><link rel="prefetch" href="/assets/js/5.f4f71278.js"><link rel="prefetch" href="/assets/js/6.8bf41b28.js"><link rel="prefetch" href="/assets/js/7.155bc031.js"><link rel="prefetch" href="/assets/js/9.aaac49c8.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a40cd8b1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><nav class="navbar"><div class="logo">Drive to JAM</div> <div class="nav-items"><a href="/" class="nav-item">Home</a> <a href="#" class="nav-item">Synergy</a> <a href="#" class="nav-item">About</a></div></nav> <div class="main-content"><div class="bio-line"><div class="author"><div class="author-img"></div>
  Tyler Merry
</div>
    Published on: 2016-11-3
  </div> <div class="content"><p>The goal of this project it to:</p> <ol><li><p>Practice consuming a rest api (or json file) with node</p></li> <li><p>Practice building, sorting, and cycling through arrays</p></li> <li><p>Figure out which game has the best ratio of viewers to streamers on</p> <blockquote><p>twitch</p></blockquote></li></ol> <p>To acomplish that we are going to build a node app. So lets get started!</p> <p>First we need to include our require documents and set up objects in the
global scope. I am using FS for things on the file system or request for
when I need to make an api request</p> <p>var fs = require(&quot;fs&quot;);</p> <p>var request = require('request');</p> <p>var contents = {}</p> <p>Next we want to define the function that &quot;does the work.&quot; The first
step of the function is to take contents that are passed into it, parses
them to json. Also included as look up the word paramaters as the things
passed into JS functions paramaters for this fuction are channelMin and
viewerMin. I use these to filter out the games where one popular
streamer is playing an obscure game and slightly altering the data. I
originally didn't have these catches in place and &quot;Gothic II&quot; was the
best game to play because rocketbeans was streaming it. I then had them
as hard coded but I thought it could be a valid use case where you want
to sweep up all the people who realize they like Gothic 2 after rocket
beans calls it a day. We loop through every game in the list and if it
meets the criteria of the channelMin and viewerMin and add them to a
games array.</p> <p>Once in the games array we apply a sort to them. This spesific sort
ranks them by their viewer to channel ratio. Sort is an ES6 function
that works by taking a function with two paramaters and applying them
against eachother over and over again.</p> <p>After we have a list of games that meet our criteria and have them
sorted we take the top 10 and add them to a string we return so it can
be printed to the screen. My original thought was to make this console
log directly from with in the function, but if I want to reuse this
later having it return a string is a step in the right direction. A
sting isn't really reusable, but if I need to have it dump out an
array, or an object its easier to build around this string then it
consol logging directly from within the function.</p> <p>var bestGamesToStream = function(contents, channelMin, viewerMin){</p> <p>var jsonContent = JSON.parse(contents);</p> <p>var games = []</p> <p>for(var i = 0; i &lt; jsonContent.top.length; i++){</p> <p>if(jsonContent.top[i].channels &gt; channelMin &amp;&amp;
jsonContent.top[i].viewers &gt; viewerMin){</p> <p>games.push({</p> <p>&quot;name&quot;: jsonContent.top[i].game.name,</p> <p>&quot;viewersPerChannel&quot;: Math.floor(jsonContent.top[i].viewers /
jsonContent.top[i].channels)</p> <p>})</p> <p>}</p> <p>}</p> <p>games.sort(function (a, b) {</p> <p>if (a.viewersPerChannel &lt; b.viewersPerChannel) {</p> <p>return 1;</p> <p>}</p> <p>if (a.viewersPerChannel &gt; b.viewersPerChannel) {</p> <p>return -1;</p> <p>}</p> <p>// a must be equal to b</p> <p>return 0;</p> <p>});</p> <p>output = &quot;&quot;</p> <p>for(var i = 0; i &lt; 10; i++){</p> <p>game = games[i];</p> <p>output += game.name + &quot;-&quot; + game.viewersPerChannel + &quot;\n&quot;</p> <p>}</p> <p>return output</p> <p>}</p> <p>The last thing we need to do is pull our data from either a file or
directly from the API and pass it to the function we do that in one of
two ways.</p> <p>From a file:</p> <p>var fileData = fs.readFileSync(&quot;twitchdata.json&quot;);</p> <p>console.log(bestGamesToStream(fileData, 4, 4000))</p> <p>From the API:</p> <p>request('https://api.twitch.tv/kraken/games/top?limit=100&amp;offset=0',
function (error, response, body) {</p> <p>if (!error &amp;&amp; response.statusCode == 200) {</p> <p>console.log(bestGamesToStream(body, 4, 4000))</p> <p>}</p> <p>})</p> <p>So when we pull it all togeather it looks something like this:</p> <p>var fs = require(&quot;fs&quot;);</p> <p>var request = require('request');</p> <p>var contents = {}</p> <p>var bestGamesToStream = function(contents, channelMin, viewerMin){</p> <p>var jsonContent = JSON.parse(contents);</p> <p>var games = []</p> <p>for(var i = 0; i &lt; jsonContent.top.length; i++){</p> <p>if(jsonContent.top[i].channels &gt; channelMin &amp;&amp;
jsonContent.top[i].viewers &gt; viewerMin){</p> <p>games.push({</p> <p>&quot;name&quot;: jsonContent.top[i].game.name,</p> <p>&quot;viewersPerChannel&quot;: Math.floor(jsonContent.top[i].viewers /
jsonContent.top[i].channels)</p> <p>})</p> <p>}</p> <p>}</p> <p>games.sort(function (a, b) {</p> <p>if (a.viewersPerChannel &lt; b.viewersPerChannel) {</p> <p>return 1;</p> <p>}</p> <p>if (a.viewersPerChannel &gt; b.viewersPerChannel) {</p> <p>return -1;</p> <p>}</p> <p>// a must be equal to b</p> <p>return 0;</p> <p>});</p> <p>output = &quot;&quot;</p> <p>for(var i = 0; i &lt; 10; i++){</p> <p>game = games[i];</p> <p>output += game.name + &quot;-&quot; + game.viewersPerChannel + &quot;\n&quot;</p> <p>}</p> <p>return output</p> <p>}</p> <p>var fileData = fs.readFileSync(&quot;twitchdata.json&quot;);</p> <p>console.log(bestGamesToStream(fileData, 4, 4000))</p> <p>Not exactly the most complicated bit of code, but it solves a problem,
no matter how contrived that problem is.</p></div></div></div></div>
    <script src="/assets/js/app.7430119d.js" defer></script><script src="/assets/js/8.877d9e53.js" defer></script>
  </body>
</html>
